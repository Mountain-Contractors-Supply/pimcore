<div {{ attributes.defaults({ class: 'bg-gray-50' }) }} data-controller="locations" data-live-component>
    <!-- Sidebar toggle button for mobile - LAST Stack: Stimulus target -->
    <button id="sidebar-toggle" aria-label="Toggle filters sidebar" data-locations-target="sidebarToggle" class="lg:hidden fixed right-4 top-24 z-30 w-10 h-10 rounded-full bg-white shadow border border-gray-200 text-gray-700">â–º</button>

    <main class="page-wrapper">
        <div class="bg-white border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <nav class="text-sm text-gray-500">
                    <a href="{{ path('home') }}" class="hover:text-gray-700">Home</a> / Locations
                </nav>
                <div class="mt-3">
                    <h1 class="text-4xl font-bold mcs-primary-text">Locations</h1>
                    <p class="mt-2 text-lg text-gray-600">Find Your Nearest Branch or Shop by Supply</p>
                </div>
            </div>
        </div>

        <div class="w-screen -ml-4 sm:-ml-6 lg:-ml-8 px-4 sm:px-6 lg:px-8 py-8 space-y-8">
            <div class="layout-wrapper grid grid-cols-2 gap-6 h-[700px]">
                <div id="filter-container" data-locations-target="filterContainer" class="sidebar bg-white border border-gray-200 rounded-xl shadow-sm lg:sticky lg:top-24 flex flex-col h-full p-5 overflow-hidden">
                        <div class="location-input-group space-y-2 flex-shrink-0">
                            <div class="location-radius-group grid grid-cols-1 sm:grid-cols-2 gap-2">
                                <div class="zip-container space-y-2">
                                    <label for="zip-input" class="text-sm font-semibold text-gray-700">Enter Your Zip Code, or City &amp; State</label>
                                    <input
                                        type="text"
                                        id="zip-input"
                                        name="zip-input"
                                        placeholder="Your Location"
                                        data-locations-target="zipInput"
                                        data-model="draftSearchTerm"
                                        value="{{ this.draftSearchTerm }}"
                                        class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500"
                                    />
                                    <!-- LAST Stack: Stimulus action for geolocation -->
                                    <button id="location-btn" type="button" data-locations-target="locationBtn" class="inline-flex items-center justify-center gap-2 rounded-md bg-gray-100 px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-200">
                                        <img src="{{ asset('images/misc/location-icon.png') }}" alt="Location" class="h-5 w-5" />
                                        Use Current Location
                                    </button>
                                </div>
                                <div class="radius-container space-y-2">
                                    <label for="radius-select" class="text-sm font-semibold text-gray-700">Radius</label>
                                    <select id="radius-select" data-locations-target="radiusSelect" class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500">
                                        <option value="10">10 miles</option>
                                        <option value="25" selected>25 miles</option>
                                        <option value="50">50 miles</option>
                                        <option value="100">100 miles</option>
                                    </select>
                                </div>
                            </div>

                            <div class="space-y-2 flex-shrink-0">
                                <h3 class="text-sm font-semibold mcs-primary-text">Search by Supply</h3>
                                <hr class="border-gray-200" />
                            </div>
                        </div>

                        {% set productChunks = this.productTypes|batch(6, []) %}
                        {% set productFilterForm = this.productFilterForm.createView() %}
                        <div class="checkbox-row grid grid-cols-1 sm:grid-cols-2 gap-x-3 gap-y-1.5 flex-1 overflow-y-auto min-h-0">
                            {% for column in productChunks %}
                                <div class="checkbox-column space-y-1.5">
                                    {% for productType in column %}
                                        {% if productType %}
                                            {% set fieldName = productType.productTypeId %}
                                            {% set field = productFilterForm[fieldName] %}
                                            <label class="flex items-center gap-2 text-xs text-gray-700 hover:bg-gray-50 rounded px-1 py-0.5 cursor-pointer">
                                                {{ form_widget(field, {
                                                    attr: {
                                                        class: 'custom-checkbox-input h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500',
                                                        'data-model': 'draftSelectedProductTypes'
                                                    }
                                                }) }}
                                                <img src="{{ asset(productType.icon) }}" alt="{{ productType.name }}" class="h-5 w-5" />
                                                <span>{{ productType.name }}</span>
                                            </label>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            {% endfor %}
                        </div>

                        <div class="button-group mt-auto flex-shrink-0 grid grid-cols-2 gap-3">
                            <button
                                type="button"
                                id="search-now-btn"
                                data-action="live#action"
                                data-live-action-param="applyFilters"
                                class="rounded-md bg-blue-600 px-4 py-2 text-sm font-semibold text-white hover:bg-blue-700"
                            >
                                Search Now
                            </button>

                            <button
                                type="button"
                                id="reset-filters-btn"
                                data-action="live#action"
                                data-live-action-param="resetFilters"
                                class="rounded-md border border-gray-300 px-4 py-2 text-sm font-semibold text-gray-700 hover:bg-gray-50"
                            >
                                Reset Filters
                            </button>
                        </div>
                    </div>

                <div id="map-wrapper" class="rounded-xl overflow-hidden border border-gray-200 shadow-sm bg-white h-full w-full">
                    <twig:LocationMap :map="this.map" />
                </div>
            </div>

            <div id="sidebar-overlay" data-locations-target="sidebarOverlay" class="fixed inset-0 bg-black/40 hidden lg:hidden"></div>

            <hr class="border-gray-200" />

            <div class="layout-wrapper grid grid-cols-1 lg:grid-cols-[1fr_360px] gap-6 items-start">
                <twig:LocationList :locations="this.filteredLocations" countHeading="{{ this.countHeading ?? 'Locations Near You' }}" />

                <aside class="sidebar">
                    <div class="flex min-h-[625px] w-full flex-col items-center justify-center rounded-xl bg-white p-6 text-center shadow-sm border border-gray-200">
                        <h2 class="text-4xl font-bold mcs-primary-text leading-tight">
                            <span id="state-count-map">__</span> STATES.<br><span id="location-count-map">__</span> LOCATIONS.
                        </h2>
                        <h3 class="mt-2 text-2xl font-semibold mcs-primary-text leading-snug">
                            ALL READY TO SERVE YOU!<br>+ FREE DELIVERY
                        </h3>
                        <div class="mt-4 flex justify-center">
                            <img src="{{ asset(getStoreLogo()) }}" alt="Mountainland Logo" class="header-logo h-10" />
                        </div>
                    </div>
                </aside>
            </div>
    </main>
</div>